{% extends 'layouts/mainpage.html' %}
{% block content %}
<body>
    
<form class="max-w-sm mx-auto flex flex-col justify-center pt-20" onsubmit="sendMessage(event)">
    <label for="message" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Ask our Model</label>
    <textarea id="message" rows="4" class="block p-2.5 w-full text-md text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Enter a prompt"></textarea>
    
    <button type="submit" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:ring-2 focus:ring-blue-500">Send</button>
  </form>

  <div id="chatbotResponse" class="max-w-sm mx-auto mt-4 p-4 bg-gray-100 rounded-lg border border-gray-300 dark:bg-gray-800 dark:border-gray-700 text-gray-900 dark:text-white"></div>
 
 <script>
  async function sendMessage(event) {
    event.preventDefault();
    const userMessage = document.getElementById('message').value;

    const response = await fetch('/api/chatbot/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': getCookie('csrftoken')
      },
      body: JSON.stringify({ message: userMessage }),
    });
    const data = await response.json();

    document.getElementById('chatbotResponse').innerText = data.response;

    document.getElementById('message').value = '';
  }

  //FUnction to get the CSRF token for Django
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie !== ''){
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  </script>
  
</body>
{%endblock%}